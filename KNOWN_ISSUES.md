# Known Issues

This document tracks bugs discovered through various analysis methods including property-based testing, concurrency testing, and hexagonal architecture analysis.

## Unconfirmed Issues

| ID       | Complexity | Status      | Source           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Location                                                                                                                                                                                                                              | Verification | Timestamp  |
| -------- | ---------- | ----------- | ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ---------- |
| ARCH-030 | MED        | unconfirmed | concurrency-test | Concurrency model violation: pure domain functions in adapter layer can't be shared across adapters without coupling. If multiple adapters use these functions concurrently through different code paths, thread-safety guarantees are implicit rather than explicit in domain layer. Moving to domain would make thread-safety contract explicit                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/mapattributes.go`, `internal/adapters/driving/caddy/attributes.go` - functions are pure and thread-safe but location violates architecture                                                           | concurrency  | 2025-12-18 |
| ARCH-031 | EASY       | unconfirmed | hex-analysis     | Code duplication risk: other adapters can't reuse MapAttributesToHeaders/sanitizeHeaderValue without importing Caddy adapter types, leading to code duplication or tight coupling. If another adapter needs similar functionality, it must duplicate logic or import `internal/adapters/driving/caddy` (violates dependency rule). Architecture impact: pure functions in adapter layer violate hexagonal architecture (pure logic should be in domain). Concurrency impact: thread-safety is implicit (functions are pure) but contract not explicit in domain layer                                                                                                                  | `internal/adapters/driving/caddy/mapattributes.go`, `internal/adapters/driving/caddy/attributes.go` - functions should be in domain for reuse                                                                                         | unit         | 2025-12-18 |
| ARCH-032 | MED        | unconfirmed | hex-analysis     | Type conversion overhead: CaddyAttributeMapper converts ports.AttributeMapping to caddy.AttributeMapping on every call (unnecessary overhead). Functions use adapter-specific type instead of port type, creating tight coupling. If functions were in domain using port types, conversion overhead would be eliminated                                                                                                                                                                                                                                                                                                                                                                | `internal/adapters/driving/caddy/attributemapper.go:19-26,35-42` (type conversion), `internal/adapters/driving/caddy/mapattributes.go:20` (uses caddy.AttributeMapping instead of ports.AttributeMapping)                             | unit         | 2025-12-18 |
| HEADER-018 | MED        | unconfirmed | property-test     | Header stripping fails for non-ASCII characters (Turkish, Greek): `http.CanonicalHeaderKey` doesn't normalize non-ASCII characters correctly for case-insensitive matching. When headers are set with case variations (e.g., "X-İşlem", "x-işlem"), deletion using canonical form fails because the keys don't match in the map. Added `deleteHeaderCaseInsensitive` helper but still failing - needs further investigation                                                                                                                                                                                                                                                                    | `internal/adapters/driving/caddy/plugin.go:1110-1136` (`deleteHeaderCaseInsensitive` function), `internal/adapters/driving/caddy/header_stripping_property_test.go:1010-1063` (`TestHeaderStripping_Property_CaseInsensitiveMatching_NonASCII`) | unit         | 2025-12-18 |
| FAKE-001   | MED        | unconfirmed | hex-analysis      | Missing fake adapter: LogoStore has CachingLogoStore (HTTP I/O) but tests use InMemoryLogoStore which isn't truly a "fake" - it's a real store. For proper hex testing, a FakeLogoStore that simulates HTTP behavior with configurable latency/failures would enable better property-based testing of logo caching behavior                                                                                                                                                                                                                                                                                                                                                                     | `internal/adapters/driven/logo/` (InMemoryLogoStore is a store, not a controllable fake for testing HTTP scenarios)                                                                                                                           | fake-adapter | 2025-12-19 |
| FAKE-002   | LOW        | unconfirmed | hex-analysis      | Missing fake adapter: AttributeMapper port interface has CaddyAttributeMapper (real adapter) but no FakeAttributeMapper for testing. While functions are pure (no I/O), a fake adapter would enable error injection testing and configurable edge case behavior. Tests currently use NewCaddyAttributeMapper() which is the real adapter. For hexagonal architecture consistency, all ports should have fake adapters                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/attributemapper.go` (CaddyAttributeMapper), `attributes_test.go` (tests use NewCaddyAttributeMapper), `internal/core/ports/attributes.go` (AttributeMapper port interface)                                                                                              | fake-adapter | 2025-12-20 |

## Confirmed Issues

| ID       | Complexity | Status    | Source       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                         | Location                                                                                                                                                                                                                                                                                  | Verification | Timestamp  |
| -------- | ---------- | --------- | ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ---------- |
| ARCH-001 | HARD       | confirmed | hex-analysis | Pure domain functions (MapAttributesToHeaders, sanitizeHeaderValue, MapAttributesToHeadersWithPrefix, ApplyHeaderPrefix) are in adapter layer instead of domain layer - violates hexagonal architecture principle that pure logic without I/O should be in domain                                                                                                                                                                                   | `internal/adapters/driving/caddy/mapattributes.go`, `internal/adapters/driving/caddy/attributes.go`, `internal/adapters/driving/caddy/config.go`                                                                                                                                          | unit         | 2025-12-17 |
| ARCH-002 | MED        | confirmed | hex-analysis | Tests in root package directly call adapter functions instead of testing through ports/interfaces or domain functions - violates hexagonal architecture testing principles. Partially addressed: port interface created (ARCH-006, ARCH-007, ARCH-008), tests refactored to use port interface, but some direct calls may remain                                                                                                                    | `attributes_test.go`, `attributes_fuzz_test.go` (root package) calling `internal/adapters/driving/caddy` functions                                                                                                                                                                        | unit         | 2025-12-17 |
| ARCH-005 | HARD       | confirmed | hex-analysis | Source files in root directory violate hexagonal architecture - many .go files in root should be organized in subdirectories with clear separation between domain, ports, and adapters                                                                                                                                                                                                                                                              | Root directory: `attributes.go`, `attributes_test.go`, `attributes_fuzz_test.go`, `config.go`, `plugin.go`, `metadata.go`, `saml.go`, `session.go`, `signature.go`, `request.go`, `errors.go`, `logo.go`, `metrics.go`, `templates.go`, `caddyfile.go`, `testing.go`, and many test files | unit         | 2025-12-17 |
| ARCH-010 | MED        | confirmed | hex-analysis | Package boundary confusion in tests: 4 root package tests import internal packages directly (all intentional): `root_reexport_differential_test.go`, `root_reexport_edge_cases_test.go`, `type_alias_property_test.go`, `metadata_bench_test.go`. Fixed: `force_authn_test.go`, `saml_test.go`, `plugin_test.go`, `plugin_fuzz_test.go`, `plugin_fuzz_ci_test.go`, `attributes_test.go`, `concurrency_port_test.go` now use root package re-exports | `package_boundary_analysis_test.go` (analysis confirms 4 intentional files remain), `metadata.go` (added scope function re-exports), `config.go` (added port interface re-exports)                                                                                                        | unit         | 2025-12-18 |

## Resolved Issues

| ID           | Complexity | Status  | Source            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Location                                                                                                                                                                                                                                                                                                                                                                                                    | Verification | Timestamp |
| ------------ | ---------- | ------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | --------- |
| ARCH-009     | MED        | wontfix | differential-test | Root package re-exports vs direct internal package imports may behave differently: differential test in `root_reexport_differential_test.go` confirms type aliases and var re-exports behave identically to direct imports - no behavioral differences found. All edge case tests (ARCH-013 through ARCH-016) also pass, confirming no bugs                                                                                                                                                                                                                                                                   | `root_reexport_differential_test.go`, `root_reexport_edge_cases_test.go` (edge case tests created), root package re-export files vs direct imports from `internal/core/domain`, `internal/core/ports`, `internal/adapters/`                                                                                                                                                                                 | differential | 2025-12-18   |
| ARCH-013     | MED        | wontfix | differential-test | Type assertion failures in context values: edge case test confirms that storing root package `Session` in context and retrieving with `*domain.Session` type assertion works correctly - type aliases are identical at runtime                                                                                                                                                                                                                                                                                                                                                                                | `root_reexport_edge_cases_test.go` `TestRootReexport_EdgeCase_ContextValueTypeAssertion`, `internal/adapters/driving/caddy/plugin.go:46`                                                                                                                                                                                                                                                                    | differential | 2025-12-18   |
| ARCH-014     | MED        | wontfix | differential-test | Type switch behavior differences: edge case test confirms type switches work correctly with root package aliases vs internal types - type aliases match the same cases in type switches                                                                                                                                                                                                                                                                                                                                                                                                                       | `root_reexport_edge_cases_test.go` `TestRootReexport_EdgeCase_TypeSwitch`                                                                                                                                                                                                                                                                                                                                   | differential | 2025-12-18   |
| ARCH-015     | MED        | wontfix | differential-test | JSON unmarshaling type mismatches: edge case test confirms JSON can be unmarshaled into root alias types and internal types interchangeably - no type assertion failures occur                                                                                                                                                                                                                                                                                                                                                                                                                                | `root_reexport_edge_cases_test.go` `TestRootReexport_EdgeCase_JSONUnmarshaling`                                                                                                                                                                                                                                                                                                                             | differential | 2025-12-18   |
| ARCH-016     | MED        | wontfix | concurrency-test  | Reflection-based type checks in concurrent code: concurrency test confirms reflection-based type checks work correctly in concurrent contexts - no type identity issues found between root aliases and internal types                                                                                                                                                                                                                                                                                                                                                                                         | `root_reexport_edge_cases_test.go` `TestRootReexport_EdgeCase_ReflectionConcurrent`                                                                                                                                                                                                                                                                                                                         | concurrency  | 2025-12-18   |
| ECAT-001     | MED        | fixed   | hex-analysis      | EntityAttributes (R&S, SIRTFI) present in metadata but not parsed into IdPInfo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `internal/adapters/driven/metadata/parser.go`, `internal/core/domain/metadata.go`                                                                                                                                                                                                                                                                                                                           | 2024-12-17   |
| TEST-002     | MED        | fixed   | roadmap-update    | Multi-SP handler isolation incomplete: ForSP handlers delegate to instance-level handlers instead of SP config stores                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `internal/adapters/driving/caddy/plugin.go` (handleACSForSP, handleLogoutForSP, handleSLOForSP, handleSelectIdPForSP, handleSessionInfoForSP, handleDiscoveryUIForSP)                                                                                                                                                                                                                                       | 2024-12-17   |
| TEST-003     | MED        | fixed   | roadmap-update    | Missing property-based test for session isolation between SP configs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `internal/adapters/driving/caddy/isolation_property_test.go` with `TestSAMLDisco_MultiSP_Property_SessionIsolation`                                                                                                                                                                                                                                                                                         | 2024-12-17   |
| TEST-004     | MED        | fixed   | roadmap-update    | Missing integration tests for end-to-end multi-SP flow                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `tests/integration/multisp_test.go` with `TestMultiSP_EndToEndFlow` and `TestMultiSP_SessionIsolation`                                                                                                                                                                                                                                                                                                      | 2024-12-17   |
| ATTR-003     | EASY       | fixed   | property-test     | Missing property test for empty separator handling in MapAttributesToHeaders: empty separator should default to ";"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `internal/adapters/driving/caddy/mapattributes.go`, separator handling logic, `attributes_test.go` `TestMapAttributesToHeaders_Property_EmptySeparatorDefaults`                                                                                                                                                                                                                                             | 2025-12-17   |
| ATTR-005     | MED        | fixed   | unit-test         | Separator that sanitizes to empty string doesn't re-default to ";": after sanitization, if separator becomes empty (e.g., contains only control characters), values are concatenated without separator instead of using default ";"                                                                                                                                                                                                                                                                                                                                                                           | `internal/adapters/driving/caddy/mapattributes.go` lines 64-70, separator sanitization logic                                                                                                                                                                                                                                                                                                                | 2025-12-17   |
| ATTR-006     | MED        | fixed   | unit-test         | Same separator sanitization bug in MapEntitlementsToHeaders: separator that sanitizes to empty doesn't re-default to ";"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/entitlements.go` lines 26-30, separator handling logic                                                                                                                                                                                                                                                                                                                     | 2025-12-17   |
| ATTR-004     | MED        | wontfix | differential-test | Potential behavioral differences between old and new attribute mapping implementations after hexagonal refactoring - differential tests confirm current behavior is correct and intended                                                                                                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/mapattributes.go`, `attributes_test.go` `TestMapAttributesToHeaders_Differential_Comprehensive`                                                                                                                                                                                                                                                                            | 2025-12-17   |
| ATTR-007     | MED        | wontfix | differential-test | When IdP sends both OID and friendly name with different values, configured form takes precedence - this is correct behavior (configured form should be authoritative)                                                                                                                                                                                                                                                                                                                                                                                                                                        | `internal/adapters/driving/caddy/mapattributes.go` lines 36-47, `attributes_test.go` `TestMapAttributesToHeaders_Differential_BothFormsDifferentValues`                                                                                                                                                                                                                                                     | 2025-12-17   |
| ATTR-008     | MED        | wontfix | differential-test | Multiple mappings referencing same logical attribute process independently - this is correct behavior (each mapping uses its configured form, allowing flexibility)                                                                                                                                                                                                                                                                                                                                                                                                                                           | `internal/adapters/driving/caddy/mapattributes.go` lines 20-87, `attributes_test.go` `TestMapAttributesToHeaders_Differential_MultipleMappingsSameAttribute`                                                                                                                                                                                                                                                | 2025-12-17   |
| ATTR-009     | MED        | wontfix | differential-test | Attribute lookup order: configured form first, then fallback to alternate - this is correct behavior (configured form is authoritative, fallback provides compatibility)                                                                                                                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/mapattributes.go` lines 36-47, `attributes_test.go` `TestMapAttributesToHeaders_Differential_LookupOrder`                                                                                                                                                                                                                                                                  | 2025-12-17   |
| ATTR-010     | MED        | wontfix | differential-test | Empty value filtering before joining - this is correct behavior (empty values should not appear in headers)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `internal/adapters/driving/caddy/mapattributes.go` lines 53-62, `attributes_test.go` `TestMapAttributesToHeaders_Differential_EmptyValueHandling`                                                                                                                                                                                                                                                           | 2025-12-17   |
| ATTR-011     | EASY       | wontfix | differential-test | Case-sensitive attribute name matching - this is correct behavior (SAML attribute names are case-sensitive per specification)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `internal/adapters/driving/caddy/mapattributes.go` lines 37, 41, 45, `attributes_test.go` `TestMapAttributesToHeaders_Differential_CaseSensitivity`                                                                                                                                                                                                                                                         | 2025-12-17   |
| ATTR-002     | MED        | fixed   | property-test     | Missing property test for MapAttributesToHeaders prefix application: prefix application should be consistent regardless of mapping order                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/attributes.go`, `MapAttributesToHeadersWithPrefix` lines 65-83, `attributes_test.go` `TestMapAttributesToHeadersWithPrefix_Property_PrefixConsistentRegardlessOfOrder`                                                                                                                                                                                                     | 2025-12-17   |
| ATTR-012     | MED        | fixed   | property-test     | Missing property test for order dependency when multiple mappings produce same header name: if mappings in different orders produce same header name (after prefix), final value depends on order (last mapping wins) - verify this is consistent behavior                                                                                                                                                                                                                                                                                                                                                    | `internal/adapters/driving/caddy/attributes.go`, `MapAttributesToHeadersWithPrefix` lines 65-86, `internal/adapters/driving/caddy/mapattributes.go` lines 20-87, `attributes_test.go` `TestMapAttributesToHeadersWithPrefix_Property_OrderDependencyConsistent`                                                                                                                                             | 2025-12-17   |
| ATTR-001     | MED        | fixed   | property-test     | Missing roundtrip property test for ResolveAttributeName: resolving OID→friendly→OID should be idempotent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `internal/core/domain/attributes.go`, `ResolveAttributeName` function, `attributes_test.go` `TestResolveAttributeName_Property_RoundtripOIDToFriendlyToOID`                                                                                                                                                                                                                                                 | 2025-12-17   |
| ATTR-013     | EASY       | fixed   | unit-test         | Test bug: TestResolveAttributeName_Property_Bidirectionality line 601 had swapped return values (friendlyName3, oid3 should be oid3, friendlyName3)                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `attributes_test.go` line 601                                                                                                                                                                                                                                                                                                                                                                               | 2025-12-17   |
| ATTR-014     | MED        | fixed   | property-test     | Missing property test for oidRegistry bidirectional consistency: if OID A maps to friendly B, then friendly B must map back to OID A (no validation prevents registry corruption)                                                                                                                                                                                                                                                                                                                                                                                                                             | `internal/core/domain/attributes.go`, `oidRegistry` map, `attributes_test.go` `TestResolveAttributeName_Property_RegistryConsistency`                                                                                                                                                                                                                                                                       | 2025-12-17   |
| ATTR-015     | MED        | fixed   | property-test     | Missing property test for edge case: friendly name starting with "urn:oid:" prefix would be incorrectly treated as OID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `internal/core/domain/attributes.go` line 47, `strings.HasPrefix` check, `attributes_test.go` `TestResolveAttributeName_Property_FriendlyNameWithOIDPrefix`                                                                                                                                                                                                                                                 | 2025-12-17   |
| TEST-005     | MED        | fixed   | unit-test         | Test accessed unexported field `store.logger` in metadata store - fixed by testing logger behavior instead of accessing private field                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `metadata_test.go:2741`, changed to test through behavior verification                                                                                                                                                                                                                                                                                                                                      | 2025-12-17   |
| TEST-006     | MED        | fixed   | unit-test         | Test referenced undefined function `filterIdPsByRegistrationAuthority` - fixed by exporting function and adding wrapper in metadata.go                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `internal/adapters/driven/metadata/file.go:215`, `metadata.go:64`, `metadata_test.go:3194`                                                                                                                                                                                                                                                                                                                  | 2025-12-17   |
| TEST-007     | MED        | fixed   | unit-test         | Tests accessed unexported Prometheus metric fields - fixed by gathering metrics from registry instead of accessing private fields                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `metrics_test.go:47,52,57,76,81,86,102,107`, changed to use registry gathering                                                                                                                                                                                                                                                                                                                              | 2025-12-17   |
| ARCH-003     | MED        | fixed   | hex-analysis      | Missing exported wrapper for filterIdPsByRegistrationAuthority - fixed by exporting function and adding wrapper                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `internal/adapters/driven/metadata/file.go:215`, `metadata.go:64`                                                                                                                                                                                                                                                                                                                                           | 2025-12-17   |
| ARCH-004     | MED        | fixed   | hex-analysis      | Tests in root package accessed adapter internals - fixed by updating tests to use public interfaces                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `metadata_test.go:2741`, `metadata_test.go:3194`, `metrics_test.go`                                                                                                                                                                                                                                                                                                                                         | 2025-12-17   |
| ATTR-016     | MED        | fixed   | property-test     | Missing property test for sanitizeHeaderValue idempotency: sanitizing a value twice should produce the same result - property test confirms function is already idempotent                                                                                                                                                                                                                                                                                                                                                                                                                                    | `internal/adapters/driving/caddy/attributes.go:13-51`, `attributes_test.go` `TestSanitizeHeaderValue_Property_Idempotency`                                                                                                                                                                                                                                                                                  | 2025-12-17   |
| ATTR-017     | MED        | wontfix | property-test     | Missing property test for ApplyHeaderPrefix associativity: double-prefix behavior is intentional (string concatenation) - property test confirms associativity holds and documents behavior                                                                                                                                                                                                                                                                                                                                                                                                                   | `internal/adapters/driving/caddy/config.go:370-377`, `attributes_test.go` `TestApplyHeaderPrefix_Property_Associativity`                                                                                                                                                                                                                                                                                    | 2025-12-17   |
| ATTR-018     | MED        | wontfix | property-test     | Missing property test for MapAttributesToHeadersWithPrefix double-prefix: double-prefix behavior is intentional (consistent with ApplyHeaderPrefix string concatenation) - property test documents behavior                                                                                                                                                                                                                                                                                                                                                                                                   | `internal/adapters/driving/caddy/attributes.go:57-94`, `attributes_test.go` `TestMapAttributesToHeadersWithPrefix_Property_DoublePrefix`                                                                                                                                                                                                                                                                    | 2025-12-17   |
| TEST-001     | MED        | fixed   | hex-analysis      | Test files reference functions moved to adapter during hexagonal architecture refactoring: MapAttributesToHeadersWithPrefix not re-exported in config.go - function is already exported in plugin.go and tests pass                                                                                                                                                                                                                                                                                                                                                                                           | `plugin.go:25` (MapAttributesToHeadersWithPrefix exported), `attributes_test.go`, `attributes_fuzz_test.go`                                                                                                                                                                                                                                                                                                 | 2025-12-17   |
| TEST-008     | EASY       | fixed   | hex-analysis      | Missing re-export of MapAttributesToHeadersWithPrefix in root package config.go - function is already exported in plugin.go and accessible to tests                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `plugin.go:25` (MapAttributesToHeadersWithPrefix exported), `attributes_test.go` lines 1041, 1061, 1094, 1113, 1128, 1188, 1189, 1273, 1274                                                                                                                                                                                                                                                                 | 2025-12-17   |
| ATTR-019     | MED        | fixed   | property-test     | Missing property test for MapAttributesToHeadersWithPrefix idempotency: calling with same inputs twice should produce identical outputs - property test confirms function is already idempotent                                                                                                                                                                                                                                                                                                                                                                                                               | `internal/adapters/driving/caddy/attributes.go:57-94`, `attributes_test.go` `TestMapAttributesToHeadersWithPrefix_Property_Idempotency`                                                                                                                                                                                                                                                                     | 2025-12-17   |
| ATTR-020     | MED        | fixed   | concurrency-test  | Missing property test for MapAttributesToHeaders thread-safety: concurrent calls with different inputs should not interfere (functions are pure but should verify no shared mutable state) - concurrency test confirms thread-safety                                                                                                                                                                                                                                                                                                                                                                          | `internal/adapters/driving/caddy/mapattributes.go:20-87`, `internal/adapters/driving/caddy/attributes.go:57-94`, `attributes_test.go` `TestMapAttributesToHeaders_Property_ThreadSafety`                                                                                                                                                                                                                    | 2025-12-17   |
| ATTR-021     | MED        | fixed   | differential-test | Missing differential test comparing MapAttributesToHeaders vs MapAttributesToHeadersWithPrefix(prefix="") - should produce identical results - differential test confirms equivalence                                                                                                                                                                                                                                                                                                                                                                                                                         | `internal/adapters/driving/caddy/mapattributes.go:20-87`, `internal/adapters/driving/caddy/attributes.go:57-94`, `attributes_test.go` `TestMapAttributesToHeaders_Differential_WithPrefixEquivalence`                                                                                                                                                                                                       | 2025-12-17   |
| METADATA-003 | MED        | fixed   | concurrency-test  | Potential race condition: concurrent Refresh() calls while background refresh goroutine is running could cause duplicate HTTP requests or inconsistent state - fixed by adding refreshMu mutex and refreshing flag to prevent concurrent refreshes                                                                                                                                                                                                                                                                                                                                                            | `internal/adapters/driven/metadata/url.go:225-260`, doRefresh() now uses refreshMu to serialize refresh operations, `metadata_test.go` `TestURLMetadataStore_Concurrency_ConcurrentRefresh`                                                                                                                                                                                                                 | 2025-12-17   |
| METADATA-004 | MED        | fixed   | concurrency-test  | Missing concurrency test for concurrent GetIdP()/ListIdPs() reads during Refresh() write - added test and verified no data races with RWMutex protecting reads                                                                                                                                                                                                                                                                                                                                                                                                                                                | `internal/adapters/driven/metadata/url.go:138-170`, concurrent read operations during Refresh() are safe with RWMutex, `metadata_test.go` `TestURLMetadataStore_Concurrency_ReadsDuringWrite`                                                                                                                                                                                                               | 2025-12-17   |
| METADATA-006 | MED        | fixed   | concurrency-test  | Race condition with stale etag/lastModified: fixed by reading etag/lastModified while holding both refreshMu and mu locks to ensure atomic read with refresh state                                                                                                                                                                                                                                                                                                                                                                                                                                            | `internal/adapters/driven/metadata/url.go:246-249`, etag/lastModified now read atomically with refresh check, `metadata_test.go` `TestURLMetadataStore_Concurrency_StaleEtag`                                                                                                                                                                                                                               | 2025-12-17   |
| METADATA-007 | MED        | fixed   | concurrency-test  | Close() cannot cancel in-progress HTTP requests: fixed by using cancellable context (refreshCtx) in refreshLoop and calling refreshCancel in Close()                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `internal/adapters/driven/metadata/url.go:82-87,121-129,90-116`, refreshLoop uses cancellable context, Close() cancels it, `metadata_test.go` `TestURLMetadataStore_Concurrency_CloseCancelsRefresh`                                                                                                                                                                                                        | 2025-12-17   |
| METADATA-008 | MED        | fixed   | concurrency-test  | Missing refresh-in-progress synchronization: fixed by adding refreshMu mutex and refreshing flag to ensure only one refresh executes at a time                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `internal/adapters/driven/metadata/url.go:33-35,225-260`, refreshMu and refreshing flag prevent concurrent refreshes, `metadata_test.go` `TestURLMetadataStore_Concurrency_RefreshInProgress`                                                                                                                                                                                                               | 2025-12-17   |
| METADATA-012 | EASY       | fixed   | property-test     | Bug: FilterIdPsByRegistrationAuthority with empty patterns after trimming (e.g., "pattern1,,pattern2" becomes ["pattern1", "", "pattern2"]) - empty pattern matches EVERYTHING via MatchesEntityIDPattern("", anything)=true, causing filter to return all IdPs instead of filtering - fixed by filtering out empty patterns after trimming                                                                                                                                                                                                                                                                   | `internal/adapters/driven/metadata/file.go:198-207,237-238`, filterEmptyStrings helper function and usage in FilterIdPsByRegistrationAuthority, `metadata_test.go` TestFilterIdPsByRegistrationAuthority empty pattern test cases                                                                                                                                                                           | 2025-12-18   |
| METADATA-013 | EASY       | fixed   | hex-analysis      | Inefficiency: FilterIdPsByEntityCategory and FilterIdPsByAssuranceCertification process empty strings after trimming (e.g., "cat1,,cat2" includes "" in categoryList/certList) - empty strings never match but are still iterated, wasting cycles - fixed by filtering out empty strings after trimming                                                                                                                                                                                                                                                                                                       | `internal/adapters/driven/metadata/file.go:198-207,268,310`, filterEmptyStrings helper function and usage in FilterIdPsByEntityCategory and FilterIdPsByAssuranceCertification, `metadata_test.go` TestFilterIdPsByEntityCategory and TestFilterIdPsByAssuranceCertification empty string test cases                                                                                                        | 2025-12-18   |
| METADATA-014 | MED        | fixed   | property-test     | Error message order dependency: when multiple filters reduce IdP set to zero, different filter orders produce different error messages (first filter that reduces to zero wins). This is a behavioral inconsistency - error message depends on filter application order rather than which filter actually caused the failure. Architecture: filters are pure functions in adapter layer (correct), applied during serialized Refresh() (no concurrency issues), but error messages violate determinism. Fixed by collecting all filter failures before returning error, ensuring deterministic error messages | `internal/adapters/driven/metadata/file.go:131-173,185-230`, `internal/adapters/driven/metadata/url.go:338-376,398-433`, `applyFiltersAndCollectFailures` helper function, `metadata_test.go` `TestFileMetadataStore_Property_MultipleFilterFailures_DeterministicError`, `TestURLMetadataStore_Property_MultipleFilterFailures_DeterministicError`                                                         | 2025-12-18   |
| METADATA-015 | MED        | fixed   | property-test     | Missing diagnostic information: when multiple filters would reduce IdP set to zero, only the first failing filter's error message is returned. Users cannot see all failing filters, making debugging harder. Early termination after each filter masks which filters would fail if applied in different orders. Fixed by collecting all filter failures and returning comprehensive error message that includes all failing filters                                                                                                                                                                          | `internal/adapters/driven/metadata/file.go:131-173,185-230`, `internal/adapters/driven/metadata/url.go:338-376,398-433`, `applyFiltersAndCollectFailures` helper function, `metadata_test.go` `TestFileMetadataStore_Property_MultipleFilterFailures_DeterministicError`, `TestFileMetadataStore_Property_PartialFilterFailures`, `TestURLMetadataStore_Property_MultipleFilterFailures_DeterministicError` | 2025-12-18   |
| REFACTOR-001 | MED        | fixed   | roadmap-update    | Code duplication: `applyFiltersAndCollectFailures()` method duplicated between FileMetadataStore and URLMetadataStore with identical logic. Fixed by extracting shared helper function `applyFiltersAndCollectFailures()` that takes filter configs as parameters, eliminating duplication while maintaining same behavior                                                                                                                                                                                                                                                                                    | `internal/adapters/driven/metadata/file.go:156-200`, `internal/adapters/driven/metadata/url.go:367-375`                                                                                                                                                                                                                                                                                                     | 2025-12-18   |
| METADATA-001 | MED        | fixed   | property-test     | Missing property test for filterIdPsByRegistrationAuthority idempotency: applying filter twice should produce same result - property test confirms function is already idempotent                                                                                                                                                                                                                                                                                                                                                                                                                             | `internal/adapters/driven/metadata/file.go:260-289`, `metadata_test.go` `TestFilterIdPsByRegistrationAuthority_Property_Idempotency`                                                                                                                                                                                                                                                                        | 2025-12-18   |
| METADATA-002 | MED        | fixed   | property-test     | Missing property test for filterIdPsByRegistrationAuthority order independence: comma-separated patterns in different orders should produce same result - property test confirms function handles order correctly                                                                                                                                                                                                                                                                                                                                                                                             | `internal/adapters/driven/metadata/file.go:260-289`, `metadata_test.go` `TestFilterIdPsByRegistrationAuthority_Property_OrderIndependence`                                                                                                                                                                                                                                                                  | 2025-12-18   |
| METADATA-009 | MED        | fixed   | property-test     | Potential bug: filterIdPs returns same slice reference when pattern is empty - test verifies current behavior (returns same reference, which is documented)                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `internal/adapters/driven/metadata/file.go:244-255`, `metadata_test.go` `TestFilterIdPs_EmptyPattern_ReturnsNewSlice`                                                                                                                                                                                                                                                                                       | 2025-12-18   |
| METADATA-010 | MED        | fixed   | property-test     | Potential bug: FilterIdPsByRegistrationAuthority with duplicate patterns in comma-separated list - test confirms duplicate patterns are handled correctly with no side effects                                                                                                                                                                                                                                                                                                                                                                                                                                | `internal/adapters/driven/metadata/file.go:260-289`, `metadata_test.go` `TestFilterIdPsByRegistrationAuthority_DuplicatePatterns`                                                                                                                                                                                                                                                                           | 2025-12-18   |
| METADATA-011 | MED        | fixed   | property-test     | Potential bug: filter order dependency - property test verifies filters are commutative (applying in different orders produces same result)                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `internal/adapters/driven/metadata/file.go:169-218`, `metadata_test.go` `TestApplyFilters_Property_OrderIndependence`                                                                                                                                                                                                                                                                                       | 2025-12-18   |
| ARCH-006     | MED        | fixed   | hex-analysis      | Missing port interface for attribute mapping operations: Created AttributeMapper port interface in `internal/core/ports/attributes.go` with MapAttributesToHeaders and MapAttributesToHeadersWithPrefix methods                                                                                                                                                                                                                                                                                                                                                                                               | `internal/core/ports/attributes.go`, `internal/adapters/driving/caddy/attributemapper.go`                                                                                                                                                                                                                                                                                                                   | 2025-12-18   |
| ARCH-007     | MED        | fixed   | hex-analysis      | Tests tightly coupled to adapter implementation: Refactored tests to use AttributeMapper port interface through helper functions mapAttributesToHeadersViaPort and mapAttributesToHeadersWithPrefixViaPort                                                                                                                                                                                                                                                                                                                                                                                                    | `attributes_test.go`, `attributes_fuzz_test.go`, helper functions mapAttributesToHeadersViaPort, mapAttributesToHeadersWithPrefixViaPort                                                                                                                                                                                                                                                                    | 2025-12-18   |
| ARCH-008     | MED        | fixed   | concurrency-test  | Missing port contract for thread-safety guarantees: Port interface documents thread-safety requirement, and tests now verify behavior through port contract rather than implementation details                                                                                                                                                                                                                                                                                                                                                                                                                | `internal/core/ports/attributes.go` (interface documentation), `attributes_test.go` (tests use port interface)                                                                                                                                                                                                                                                                                              | 2025-12-18   |
| ARCH-011     | EASY       | wontfix | hex-analysis      | Import cycle risk: root package re-exports create potential for accidental import cycles if internal packages try to import root package - verified no cycles currently exist (checked via `go list` and grep), but architectural violation makes cycles easier to introduce during refactoring. Preventive test created in `import_cycle_test.go`                                                                                                                                                                                                                                                            | `import_cycle_test.go` (preventive test created), verified no `internal/` packages import root package via `go list` and grep analysis                                                                                                                                                                                                                                                                      | 2025-12-18   |
| ARCH-012     | EASY       | fixed   | unit-test         | Test files created for ARCH-009/ARCH-010/ARCH-011 had unused imports (`go/ast` in `import_cycle_test.go` and `package_boundary_analysis_test.go`) and formatting inconsistencies - fixed by removing unused imports and aligning formatting                                                                                                                                                                                                                                                                                                                                                                   | `import_cycle_test.go`, `package_boundary_analysis_test.go`, `root_reexport_differential_test.go`                                                                                                                                                                                                                                                                                                           | 2025-12-18   |
| ARCH-017     | MED        | fixed   | hex-analysis      | Testing wrong code path: Tests importing internal packages directly (e.g., `plugin_fuzz_test.go` using `caddyadapter.`, `metadata.`, `domain.`) bypass root package re-exports, potentially missing bugs in re-export layer that only occur when going through root package - fixed by re-exporting utility functions (`ValidateRelayState`, `ParseAcceptLanguage`, `ParseDuration`, `MatchesForceAuthnPath`, `ValidateAuthnContextComparison`) and updating `plugin_fuzz_test.go` to use root package re-exports                                                                                             | `plugin.go` (added re-exports), `saml.go` (added ValidateAuthnContextComparison re-export), `plugin_fuzz_test.go` (updated to use root package re-exports)                                                                                                                                                                                                                                                  | 2025-12-18   |
| ARCH-018     | MED        | fixed   | hex-analysis      | Missing port contract verification: Tests bypassing port interfaces (e.g., `plugin_fuzz_test.go` calling `caddyadapter.` functions directly) might miss bugs related to port contract guarantees (thread-safety, error handling, type conversions) that only appear when using port interface through root package - fixed by updating `plugin_fuzz_test.go` to use root package re-exports instead of direct adapter calls                                                                                                                                                                                   | `plugin_fuzz_test.go` (updated to use root package re-exports: `ValidateRelayState`, `ParseAcceptLanguage`, `ParseDuration`, `MatchesForceAuthnPath`, `NewSAMLService`)                                                                                                                                                                                                                                     | 2025-12-18   |
| ARCH-019     | MED        | fixed   | hex-analysis      | Type identity bugs: Tests using internal types directly (e.g., `plugin_fuzz_test.go` using `domain.IdPInfo`, `domain.AuthnOptions`) might miss bugs related to type aliases in root package re-exports, especially in type assertions, JSON marshaling, or context value storage - fixed by updating `plugin_fuzz_test.go` to use root package type aliases (`IdPInfo`, `AuthnOptions`)                                                                                                                                                                                                                       | `plugin_fuzz_test.go` (updated to use root package types: `IdPInfo`, `AuthnOptions` instead of `domain.IdPInfo`, `domain.AuthnOptions`)                                                                                                                                                                                                                                                                     | 2025-12-18   |
| ARCH-020     | MED        | fixed   | concurrency-test  | Concurrency model violations: Tests importing adapters directly might test adapters in isolation, missing thread-safety issues that only appear when using port interface contract through root package. Port interfaces require thread-safety guarantees that might not be verified when bypassing ports - fixed by updating `plugin_fuzz_test.go` to use root package re-exports, ensuring tests exercise the same code path as production                                                                                                                                                                  | `plugin_fuzz_test.go` (updated to use root package re-exports instead of direct adapter imports)                                                                                                                                                                                                                                                                                                            | 2025-12-18   |
| ARCH-021     | MED        | fixed   | hex-analysis      | Coverage gaps in re-export layer: Tests bypassing root package re-exports might miss bugs that only occur when going through re-export layer (type alias conversions, var re-exports, function wrappers). Root package re-exports add an indirection layer that could introduce bugs not present in direct internal package usage - fixed by updating `plugin_fuzz_test.go` to use root package re-exports, ensuring tests exercise the re-export layer                                                                                                                                                       | `plugin_fuzz_test.go` (updated to use root package re-exports), `plugin.go` (added re-exports for utility functions)                                                                                                                                                                                                                                                                                        | 2025-12-18   |
| ARCH-022     | MED        | fixed   | hex-analysis      | Benchmark accuracy: Benchmarks importing internal packages directly (e.g., `metadata_bench_test.go` using `metadata.ParseMetadata` directly) don't reflect real-world usage through root package re-exports, potentially giving misleading performance characteristics - fixed by adding comment explaining that direct `metadata.ParseMetadata` import is intentional for benchmarking raw parsing performance as an internal implementation detail. In production, metadata parsing goes through MetadataStore interface                                                                                    | `metadata_bench_test.go` (added comment explaining intentional direct import for benchmarking performance of raw ParseMetadata function)                                                                                                                                                                                                                                                                    | 2025-12-18   |
| ARCH-023     | MED        | fixed   | hex-analysis      | Missing re-exports for scope functions: `saml_test.go` uses `domain.ScopeInfo`, `domain.ExtractScope`, `domain.ValidateScope`, `domain.IsScopedAttribute` but these are not re-exported in root package - tests bypass root package layer - fixed by adding re-exports in `metadata.go` and updating `saml_test.go` to use root package re-exports                                                                                                                                                                                                                                                            | `metadata.go` (added ScopeInfo type and ExtractScope, ValidateScope, IsScopedAttribute function re-exports), `saml_test.go` (updated to use root package re-exports)                                                                                                                                                                                                                                        | 2025-12-18   |
| ARCH-024     | MED        | fixed   | hex-analysis      | Missing re-export for `ParseMetadata`: `plugin_fuzz_test.go` and `metadata_bench_test.go` import `internal/adapters/driven/metadata` to use `metadata.ParseMetadata` - function should be re-exported for tests that need to test parsing behavior through root package - fixed by adding ParseMetadata re-export in `metadata.go` and updating `plugin_fuzz_test.go` to use root package re-export                                                                                                                                                                                                           | `metadata.go` (added ParseMetadata re-export), `plugin_fuzz_test.go` (updated to use root package re-export)                                                                                                                                                                                                                                                                                                | 2025-12-18   |
| ARCH-025     | EASY       | fixed   | hex-analysis      | `force_authn_test.go` bypasses root re-export: uses `caddyadapter.MatchesForceAuthnPath` directly even though function is already re-exported in `plugin.go:30` as `MatchesForceAuthnPath` - fixed by removing caddyadapter import and using root package re-export                                                                                                                                                                                                                                                                                                                                           | `force_authn_test.go` (removed caddyadapter import, using MatchesForceAuthnPath from root package)                                                                                                                                                                                                                                                                                                          | 2025-12-18   |
| ARCH-026     | MED        | fixed   | hex-analysis      | `plugin_fuzz_ci_test.go` bypasses root re-exports: uses `caddyadapter.ValidateRelayState`, `caddyadapter.ParseAcceptLanguage`, `caddyadapter.ParseDuration`, `metadata.ParseMetadata` directly instead of using existing re-exports in `plugin.go:27-30` - fixed by removing internal imports and using root package re-exports                                                                                                                                                                                                                                                                               | `plugin_fuzz_ci_test.go` (removed caddyadapter and metadata imports, using root package re-exports: ValidateRelayState, ParseAcceptLanguage, ParseDuration, ParseMetadata)                                                                                                                                                                                                                                  | 2025-12-18   |
| ARCH-027     | MED        | wontfix | property-test     | Type conversion bugs: CaddyAttributeMapper converts ports.AttributeMapping to caddy.AttributeMapping - property test confirms roundtrip conversion preserves all fields correctly. No bugs found - conversion works correctly. Architectural concern remains (types could diverge in future), but current behavior is correct                                                                                                                                                                                                                                                                                 | `internal/adapters/driving/caddy/attributemapper.go:17-29,32-45`, `attributes_test.go` `TestCaddyAttributeMapper_Property_TypeConversionRoundtrip`                                                                                                                                                                                                                                                          | 2025-12-18   |
| ARCH-029     | MED        | wontfix | differential-test | Missing differential test: port interface implementation (CaddyAttributeMapper) vs direct adapter function calls - differential test confirms both paths produce identical results. No bugs found - port interface correctly delegates to adapter functions. Architectural concern remains, but current behavior is correct                                                                                                                                                                                                                                                                                   | `internal/adapters/driving/caddy/attributemapper.go`, `internal/adapters/driving/caddy/mapattributes.go`, `attributes_test.go` `TestMapAttributesToHeaders_Differential_PortInterfaceVsDirect`, `TestMapAttributesToHeadersWithPrefix_Differential_PortInterfaceVsDirect`                                                                                                                                   | 2025-12-18   |
| BUILD-001    | EASY       | fixed   | unit-test         | Build failure: `attributes_fuzz_test.go` missing helper functions `mapAttributesToHeadersViaPort`, `newTestAttributeMapper`, `convertToPortMappings` because `attributes_test.go` has build tag `//go:build unit` and is only compiled with unit tag - fixed by adding helper functions to `attributes_fuzz_test.go`                                                                                                                                                                                                                                                                                          | `attributes_fuzz_test.go` (added helper functions), `attributes_test.go` (has `//go:build unit` tag)                                                                                                                                                                                                                                                                                                        | 2025-12-18   |
| PARSE-001    | MED        | fixed   | fuzz-test         | Bug: `ParseAcceptLanguage` returns nil instead of empty slice when all languages filtered out (e.g., `"en;q=0"`) - violates invariant that result should never be nil - fixed by initializing result as `[]string{}` instead of `var result []string`                                                                                                                                                                                                                                                                                                                                                         | `internal/adapters/driving/caddy/plugin.go:1937` (changed `var result []string` to `result := []string{}`)                                                                                                                                                                                                                                                                                                  | 2025-12-18   |
| PARSE-002    | MED        | fixed   | fuzz-test         | Bug: `ParseAcceptLanguage` allows empty language strings in result (e.g., `";;;"` produces `[""]`) - violates invariant that result should contain no empty strings - fixed by adding check to skip empty language strings after parsing                                                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driving/caddy/plugin.go:1918-1920` (added `if lang == "" { continue }` check)                                                                                                                                                                                                                                                                                                            | unit         | 2025-12-18   |
| ARCH-028     | MED        | fixed   | hex-analysis      | Validation inconsistency risk: IsValidHeaderName is in adapter layer but used by pure domain functions. If another adapter implements similar attribute mapping, it might use different validation rules, causing inconsistent behavior across adapters. Domain layer should define validation contract - fixed by moving IsValidHeaderName from adapter layer to domain layer                                                                                                                                                                                                                                                                                                | `internal/core/domain/attributes.go` (IsValidHeaderName moved here), `internal/core/domain/attributes_test.go` (added unit tests), `internal/adapters/driving/caddy/mapattributes.go`, `internal/adapters/driving/caddy/attributes.go`, `internal/adapters/driving/caddy/config.go`, `internal/adapters/driving/caddy/entitlements.go`, `internal/adapters/driving/caddy/caddyfile.go` (updated to use domain.IsValidHeaderName), `config.go` (updated re-export) | unit         | 2025-12-18   |
| ARCH-033     | MED        | fixed   | concurrency-test  | Re-export layer concurrency gaps: The 4 intentional files that import internal packages directly don't test concurrency through port interfaces - fixed by adding `TestRootReexport_Concurrency_PortInterfaceViaRoot` in `root_reexport_edge_cases_test.go` that verifies AttributeMapper port interface accessed through root package re-exports maintains thread-safety guarantees when accessed concurrently                                                                                                                                                                                                                                                                      | `root_reexport_edge_cases_test.go` `TestRootReexport_Concurrency_PortInterfaceViaRoot`                                                                                                                                                                                                                                                                                                                       | concurrency  | 2025-12-18   |
| ARCH-034     | MED        | fixed   | concurrency-test  | Type alias concurrency bugs: Type aliases in root package re-exports might have concurrency issues when accessed through root package vs direct internal imports - fixed by adding `TestRootReexport_Concurrency_TypeAliasJSONMarshaling` and `TestRootReexport_Concurrency_TypeAliasContextValues` in `root_reexport_edge_cases_test.go` that verify JSON marshaling/unmarshaling and context value storage/retrieval work correctly under concurrent access                                                                                                                                                                                                                    | `root_reexport_edge_cases_test.go` `TestRootReexport_Concurrency_TypeAliasJSONMarshaling`, `TestRootReexport_Concurrency_TypeAliasContextValues`                                                                                                                                                                                                                                                             | concurrency  | 2025-12-18   |
| ARCH-035     | MED        | fixed   | hex-analysis      | Port contract verification gaps: The 4 intentional files test equivalence but don't verify port interface contracts (error handling, behavioral guarantees, type conversions) - fixed by adding `TestRootReexport_PortContract_ErrorHandling`, `TestRootReexport_PortContract_BehavioralGuarantees`, and `TestRootReexport_PortContract_TypeConversions` in `root_reexport_differential_test.go` that verify port interface contracts are maintained when accessing through root package re-exports vs direct internal imports                                                                                                                                                    | `root_reexport_differential_test.go` `TestRootReexport_PortContract_ErrorHandling`, `TestRootReexport_PortContract_BehavioralGuarantees`, `TestRootReexport_PortContract_TypeConversions`                                                                                                                                                                                                                     | unit         | 2025-12-18   |
| CONC-001     | MED        | fixed   | concurrency-test  | CachingLogoStore TOCTOU race: concurrent requests for same uncached logo trigger multiple HTTP fetches - fixed by adding `fetchMu sync.Mutex` and `fetching map[string]chan struct{}` to serialize fetch operations per entityID with double-check locking pattern. Concurrency tests confirm only 1 HTTP fetch occurs for concurrent requests                                                                                                                                                                                                                                                                                   | `internal/adapters/driven/logo/caching.go:57-59` (fetchMu, fetching fields), `logo_test.go` `TestCachingLogoStore_Concurrency_SingleFetch`                                                                                                                                                                                                                                                                   | concurrency  | 2025-12-19   |
| CONC-002     | MED        | fixed   | concurrency-test  | CachingLogoStore race on Set: concurrent Gets could trigger multiple fetches and Set operations - fixed together with CONC-001 by fetch coordination using channel signaling. Waiters block on channel until first fetch completes, then read from cache                                                                                                                                                                                                                                                                                                                                                                          | `internal/adapters/driven/logo/caching.go:91-119` (Get method with fetch coordination), `logo_test.go` `TestCachingLogoStore_Property_CacheConsistency`                                                                                                                                                                                                                                                      | concurrency  | 2025-12-19   |
| CONC-003     | MED        | wontfix | concurrency-test  | CookieSessionStore concurrency: JWT library (github.com/lestrrat-go/jwx) is thread-safe. CookieSessionStore is stateless (only holds privateKey/duration). Concurrency tests confirm 100 concurrent Create/Get calls don't race. No fix needed - behavior is correct                                                                                                                                                                                                                                                                                                                                                              | `internal/adapters/driven/session/cookie_test.go` `TestCookieSessionStore_Concurrency_ThreadSafe`                                                                                                                                                                                                                                                                                                            | concurrency  | 2025-12-19   |
| LIFE-001     | MED        | fixed   | hex-analysis      | Request store memory leak: SAMLService was using NewInMemoryRequestStore() without cleanup. Fixed by: (1) keeping NewSAMLService with simple store for tests, (2) adding NewSAMLServiceWithCleanup for production, (3) updating plugin.go to use NewSAMLServiceWithCleanup with DefaultRequestCleanupInterval (5 min). Cleanup() already closes SAMLService instances                                                                                                                                                                                                                                                            | `internal/adapters/driving/caddy/saml.go:54-64` (NewSAMLServiceWithCleanup), `internal/adapters/driving/caddy/plugin.go:266,441` (uses NewSAMLServiceWithCleanup)                                                                                                                                                                                                                                             | unit         | 2025-12-19   |
| TEST-009     | EASY       | wontfix | hex-analysis      | Logo adapters tests: Tests already exist in root package `logo_test.go` covering InMemoryLogoStore and CachingLogoStore with unit tests, concurrency tests, and property tests. No additional test files needed in internal package                                                                                                                                                                                                                                                                                                                                                                                                | `logo_test.go` (root package) has `TestInMemoryLogoStore_*`, `TestCachingLogoStore_*` tests                                                                                                                                                                                                                                                                                                                  | unit         | 2025-12-19   |
| TEST-010     | EASY       | wontfix | hex-analysis      | Request store tests: Tests already exist in root package `request_test.go` with comprehensive unit tests and concurrency tests including `TestInMemoryRequestStore_Concurrency_*` tests. No additional test files needed                                                                                                                                                                                                                                                                                                                                                                                                          | `request_test.go` (root package) has comprehensive tests                                                                                                                                                                                                                                                                                                                                                     | concurrency  | 2025-12-19   |
| TEST-011     | EASY       | fixed   | hex-analysis      | Session store tests missing - fixed by creating `internal/adapters/driven/session/cookie_test.go` with unit tests for Create/Get/Delete operations, expiration handling, token uniqueness property test, and concurrency tests                                                                                                                                                                                                                                                                                                                                                                                                    | `internal/adapters/driven/session/cookie_test.go` (created)                                                                                                                                                                                                                                                                                                                                                  | unit         | 2025-12-19   |
| TEST-012     | EASY       | fixed   | hex-analysis      | Metrics adapter tests missing - fixed by creating `internal/adapters/driven/metrics/metrics_test.go` with unit tests for NoopMetricsRecorder and PrometheusMetricsRecorder covering all recording methods                                                                                                                                                                                                                                                                                                                                                                                                                          | `internal/adapters/driven/metrics/metrics_test.go` (created)                                                                                                                                                                                                                                                                                                                                                 | unit         | 2025-12-19   |
| TEST-013     | EASY       | fixed   | hex-analysis      | Signature adapter tests missing - fixed by creating `internal/adapters/driven/signature/signature_test.go` with unit tests for NoopVerifier, NoopSigner, XMLDsigVerifier, XMLDsigSigner including sign/verify roundtrip test                                                                                                                                                                                                                                                                                                                                                                                                      | `internal/adapters/driven/signature/signature_test.go` (created)                                                                                                                                                                                                                                                                                                                                             | unit         | 2025-12-19   |

## Status Legend

- **unconfirmed**: Potential issue identified but not yet verified
- **confirmed**: Issue verified and reproducible
- **fixed**: Issue has been resolved
- **wontfix**: Issue acknowledged but will not be fixed (with justification)

## Source Legend

- **hex-analysis**: Discovered through hexagonal architecture analysis
- **property-test**: Discovered through property-based testing
- **concurrency-test**: Discovered through concurrent access testing
- **differential-test**: Discovered through differential testing (comparing implementations)
- **roadmap-update**: Discovered during roadmap planning or tech debt tracking
- **manual**: Discovered through manual testing or code review
